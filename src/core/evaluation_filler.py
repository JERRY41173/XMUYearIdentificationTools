# -*- coding: utf-8 -*-
"""
è¯„è¯­å¡«å†™æ ¸å¿ƒæ¨¡å—
åŠŸèƒ½ï¼šè‡ªåŠ¨å¡«å†™å­¦å¹´é‰´å®šè¡¨ä¸­çš„å„ç§è¯„è¯­
"""

import os
import random
import shutil
from docx import Document
from docx.shared import Pt
from docx.oxml.ns import qn


class EvaluationFiller:
    """è¯„è¯­å¡«å†™å™¨"""
    
    def __init__(self):
        self.academic_years = ["2021-2022", "2022-2023", "2023-2024", "2024-2025"]
        self.total_expected_evaluations = 7  # 4ä¸ªå­¦å¹´æ„è§ + 3ä¸ªç»¼åˆé‰´å®šè¡¨è¯„è¯­
        
        # åˆå§‹åŒ–è¯„è¯­åº“
        self._init_evaluation_templates()
    
    def _init_evaluation_templates(self):
        """åˆå§‹åŒ–è¯„è¯­æ¨¡æ¿"""
        # å­¦å¹´æ„è§
        self.academic_year_opinions = [
            [
                "    è¯¥ç”Ÿåœ¨å­¦æœŸé—´ï¼Œæ€æƒ³æ€åº¦ç«¯æ­£ï¼Œéµå®ˆæ ¡è§„æ ¡çºªï¼Œå­¦ä¹ åˆ»è‹¦ï¼Œæˆç»©è‰¯å¥½ï¼ŒåŒæ—¶èƒ½ç§¯æå‚ä¸å®è·µæ´»åŠ¨ï¼Œå›¢é˜Ÿåä½œèƒ½åŠ›å¼ºã€‚è¯¥ç”Ÿç»¼åˆç´ è´¨é«˜ï¼Œæ˜¯ä¸€åå“å­¦å…¼ä¼˜çš„å¤§å­¦ç”Ÿã€‚",
                "    è¯¥ç”Ÿåœ¨å­¦æœŸé—´ï¼Œæ€æƒ³æ€åº¦ç«¯æ­£ï¼Œç§¯æå‘ä¸Šï¼Œå±•ç°å‡ºè¾ƒå¼ºçš„è´£ä»»æ„Ÿã€‚å­¦ä¹ è®¤çœŸï¼Œå¯Œæœ‰åˆ›æ–°ç²¾ç¥ã€‚å›¢é˜Ÿåä½œèƒ½åŠ›å¼ºï¼Œä¸åŒå­¦ç›¸å¤„è¾ƒå¥½ã€‚è¯¥ç”Ÿå…¨é¢å‘å±•ï¼Œæ˜¯ä¸€åå“å­¦å…¼ä¼˜çš„å¤§å­¦ç”Ÿã€‚"
            ],
            [
                "    è¯¥ç”Ÿåœ¨å­¦æœŸé—´ç§¯æå‘ä¸Šï¼Œå­¦ä¹ åŠªåŠ›ï¼Œå¹¶èƒ½ç§¯æå‚ä¸å„ç±»æ´»åŠ¨ï¼Œä¸æ–­æå‡è‡ªå·±çš„ç»¼åˆç´ è´¨ï¼Œæ—¥å¸¸ç”Ÿæ´»ä¸­å°Šé‡å¸ˆé•¿ï¼Œèƒ½ä¸åŒå­¦å’Œç¦ç›¸å¤„ã€‚è¯¥ç”Ÿæ˜¯ä¸€åè¡¨ç°è‰¯å¥½çš„å¤§å­¦ç”Ÿï¼Œå…·æœ‰è¾ƒå¤§çš„å‘å±•æ½œåŠ›ã€‚",
                "    è¯¥ç”Ÿåœ¨å­¦æœŸé—´å­¦ä¹ åŠªåŠ›ï¼Œæˆç»©è‰¯å¥½ï¼Œèƒ½å¤Ÿè®¤çœŸå¬è®²ã€ç§¯ææ€è€ƒï¼Œå…·æœ‰è‰¯å¥½çš„ä¸ªäººä¿®å…»ã€‚åŒæ—¶è¯¥ç”Ÿä¹Ÿç§¯æå‚ä¸é›†ä½“æ´»åŠ¨ï¼Œä¸ºç­çº§å’Œå­¦é™¢äº‰å…‰ã€‚è¯¥ç”Ÿè¡¨ç°è‰¯å¥½ï¼Œå…·æœ‰è¾ƒå¤§çš„å‘å±•æ½œåŠ›ã€‚"
            ],
            [
                "    è¯¥ç”Ÿåœ¨å­¦æœŸé—´å±•ç°å‡ºäº†è‰¯å¥½çš„ç»¼åˆç´ è´¨ï¼Œå­¦ä¹ è®¤çœŸåˆ»è‹¦ï¼Œè¿˜æ³¨é‡åŸ¹å…»è‡ªå·±çš„å…´è¶£çˆ±å¥½å’Œç‰¹é•¿ï¼Œç§¯æå‚ä¸å„ç±»æ´»åŠ¨å’Œæ¯”èµ›ï¼Œæ˜¯ä¸€åå“å­¦å…¼ä¼˜çš„å¤§å­¦ç”Ÿã€‚",
                "    è¯¥ç”Ÿåœ¨å­¦æœŸé—´å­¦ä¹ è®¤çœŸåˆ»è‹¦ï¼Œåœ¨è¯¾å ‚ä¸Šè¡¨ç°å‡ºè‰²ï¼Œè¯¾åä¹Ÿèƒ½ä¸»åŠ¨å¯»æ±‚çŸ¥è¯†ï¼Œä¸æ–­æå‡å­¦æœ¯æ°´å¹³ï¼›æ­¤å¤–ä¹Ÿæ³¨é‡åŸ¹å…»è‡ªå·±çš„å…´è¶£çˆ±å¥½å’Œç‰¹é•¿ï¼Œé›†ä½“ç”Ÿæ´»ä¸­ä¹Ÿèƒ½å¤Ÿç§¯æèå…¥å›¢é˜Ÿï¼Œæ˜¯ä¸€åå“å­¦å…¼ä¼˜çš„å¤§å­¦ç”Ÿã€‚"
            ],
            [
                "    è¯¥ç”Ÿåœ¨å­¦æœŸé—´æ€æƒ³æ€åº¦ç«¯æ­£ï¼Œæ”¿æ²»ç«‹åœºæ­£ç¡®ï¼›å­¦ä¹ è®¤çœŸï¼Œå…´è¶£çˆ±å¥½å¹¿æ³›ï¼Œç§¯æå‚ä¸é™¢æ ¡å„ç±»æ´»åŠ¨ï¼Œè¡¨ç°è‰¯å¥½ï¼›å°Šæ•¬å¸ˆé•¿ï¼Œå›¢ç»“åŒå­¦ï¼Œäººé™…å…³ç³»è‰¯å¥½ï¼Œæ˜¯ä¸€åä¼˜ç§€çš„æ¯•ä¸šç”Ÿã€‚",
                "    è¯¥ç”Ÿåœ¨å­¦æœŸé—´ä¸¥æ ¼éµå®ˆæ ¡çºªæ ¡è§„ï¼Œæ”¿æ²»ç«‹åœºæ­£ç¡®ï¼›å­¦ä¹ è®¤çœŸï¼Œå…·å¤‡è‰¯å¥½çš„ç†è®ºçŸ¥è¯†å’Œå®è·µèƒ½åŠ›ï¼›å…´è¶£çˆ±å¥½å¹¿æ³›ï¼Œå·¥ä½œè®¤çœŸï¼Œå…·æœ‰ä¸€å®šçš„ç»„ç»‡åè°ƒå’Œç®¡ç†èƒ½åŠ›ï¼›å°Šæ•¬å¸ˆé•¿ï¼Œå›¢ç»“åŒå­¦ï¼Œæ˜¯ä¸€åä¼˜ç§€çš„æ¯•ä¸šç”Ÿã€‚"
            ],
            [
                "    è¯¥ç”Ÿåœ¨å­¦æœŸé—´éµçºªå®ˆæ³•ï¼Œæ€æƒ³æ€åº¦ç«¯æ­£ï¼Œç§¯æå‘ä¸Šã€‚å­¦ä¸šæˆç»©çªå‡ºï¼Œä¸“ä¸šçŸ¥è¯†æ‰å®ï¼Œå±•ç°å‡ºè‰¯å¥½çš„å­¦æœ¯ç´ å…»ã€‚åœ¨è¯¾å¤–æ´»åŠ¨ä¸­ï¼Œè¯¥ç”Ÿå±•ç°å‡ºè‰¯å¥½çš„é¢†å¯¼åŠ›å’Œç»„ç»‡åè°ƒèƒ½åŠ›ï¼Œæ·±å—å¸ˆç”Ÿè®¤å¯ã€‚åŒæ—¶ï¼Œè¯¥ç”Ÿå…·å¤‡è‰¯å¥½çš„æ²Ÿé€šèƒ½åŠ›å’Œå›¢é˜Ÿåä½œç²¾ç¥ï¼Œæ˜¯ä¸€åå…¨é¢å‘å±•çš„ä¼˜ç§€æ¯•ä¸šç”Ÿã€‚"
            ]
        ]
        
        # ç­å›¢ç»„ç»‡é‰´å®š
        self.class_organization_evaluations = [
            "\n    è¯¥ç”Ÿæ€æƒ³ç§¯æè¦æ±‚è¿›æ­¥ï¼Œä¸“ä¸šå­¦ä¹ è®¤çœŸè¸å®ï¼Œå¹³æ—¶èƒ½å¤Ÿä¸¥æ ¼è¦æ±‚è‡ªå·±ï¼Œèƒ½å¾ˆå¥½åœ°éµå®ˆå­¦æ ¡çºªå¾‹ï¼Œé›†ä½“è£èª‰æ„Ÿå¼ºï¼Œå‚åŠ ç­é›†ä½“æ´»åŠ¨ï¼Œèƒ½ä¸åŒå­¦å‹å¥½ç›¸å¤„ï¼Œå°Šæ•¬å¸ˆé•¿ï¼Œæ˜¯ä¸€ä½ç»¼åˆç´ è´¨å…¨é¢çš„å¤§å­¦ç”Ÿã€‚",
            "\n    è¯¥ç”Ÿèƒ½å¾ˆå¥½åœ°éµå®ˆå­¦æ ¡çºªå¾‹ï¼Œé›†ä½“è£èª‰æ„Ÿå¼ºï¼Œç§¯æå‚ä¸å„é¡¹ç¤¾ä¼šå®è·µä¸é›†ä½“æ´»åŠ¨ï¼Œå…³å¿ƒé›†ä½“ï¼Œçƒ­å¿ƒä¸ºç­çº§æœåŠ¡ï¼Œç§¯æè‚¯å¹²ï¼Œå°Šæ•¬å¸ˆé•¿ï¼Œå›¢ç»“åŒå­¦ï¼›å­¦ä¹ ä¸Šåˆ»è‹¦åŠªåŠ›ï¼Œä¸“ä¸šåŸºç¡€æ‰å®ï¼Œæˆç»©ä¼˜ç§€ï¼›åœ¨ä»»å­¦ç”Ÿå¹²éƒ¨æœŸé—´ï¼Œè¡¨ç°å‡ºè¾ƒå¼ºçš„ç»„ç»‡èƒ½åŠ›ï¼Œçƒ­å¿ƒä¸ºåŒå­¦æœåŠ¡ï¼Œæ˜¯ä¸€ä½æœ‰ç†æƒ³ã€æœ‰æŠ±è´Ÿã€å…¨é¢å‘å±•çš„å¤§å­¦ç”Ÿã€‚",
            "\n    è¯¥ç”Ÿå­¦ä¹ æ€åº¦ç«¯æ­£ï¼ŒåŠ¨æ‰‹èƒ½åŠ›å¼ºï¼Œç§¯æå‚åŠ å„ç±»ç§‘åˆ›æ´»åŠ¨ï¼Œå…·å¤‡å­¦ä¹ çš„è‡ªè§‰æ€§å’Œä¸»åŠ¨æ–°ï¼Œåœ¨ç§‘ç ”æ–¹é¢å…·æœ‰æœ‰åˆ›æ–°æ„è¯†ï¼Œæœ‰ç‹¬ç«‹åˆ†æé—®é¢˜ã€è§£å†³é—®é¢˜çš„èƒ½åŠ›ï¼Œå°Šæ•¬è€å¸ˆï¼Œèƒ½ä¸åŒå­¦å‹å¥½ç›¸å¤„ï¼Œæ˜¯ä¸€ä¸ªå“å­¦å…¼ä¼˜çš„å¥½å­¦ç”Ÿã€‚",
            "\n    è¯¥ç”Ÿç§¯æå‘ä¸Šï¼Œæ´»æ³¼å¼€æœ—ï¼Œèƒ½ä¸åŒå­¦å‹å¥½ç›¸å¤„ï¼ŒåŠ©äººä¸ºä¹ï¼Œç§¯æå‚åŠ ç­çº§çš„æ´»åŠ¨ï¼Œé›†ä½“è£èª‰æ„Ÿå¼ºï¼Œçƒ­çˆ±ç­çº§ï¼Œå¤šæ¬¡å‚åŠ å„ç±»å­¦æ ¡ã€å­¦é™¢æ´»åŠ¨ï¼Œå­¦ä¹ è®¤çœŸï¼Œæœ‰é’»ç ”ç²¾ç¥å’Œåˆ›æ–°æ„è¯†ï¼Œå„æ–¹é¢è¡¨ç°éƒ½æ¯”è¾ƒä¼˜ç§€ã€‚",
            "\n    è¯¥ç”Ÿèƒ½å¾ˆå¥½åœ°å±¥è¡Œå¤§å­¦ç”Ÿè¡Œä¸ºè§„èŒƒã€‚åœ¨å­¦ä¹ ä¸Šè‚¯ä¸‹åŠŸå¤«, ä¸¥æ ¼è¦æ±‚è‡ªå·±ï¼Œå‹¤å­¦å¥½é—®,åŠªåŠ›é’»ç ”,å°Šæ•¬å¸ˆé•¿,å›¢ç»“åŒå­¦,ç§¯æå‚åŠ å„ç±»é›†ä½“æ´»åŠ¨å’Œç¤¾ä¼šå®è·µæ´»åŠ¨ã€‚å­¦ä¹ ç›®æ ‡æ˜ç¡®,åˆ»è‹¦è®¤çœŸ,æ˜¯ä½ç»¼åˆç´ è´¨è¾ƒé«˜çš„å­¦ç”Ÿã€‚"
        ]
        
        # ç­ä¸»ä»»ç»¼åˆè¯„è¯­
        self.class_teacher_evaluations = [
            "\n    åœ¨æ ¡æœŸé—´ï¼Œè¯¥ç”Ÿæ€æƒ³ä¸Šè¿›ï¼Œä½œé£ä¸¥è°¨ï¼Œæ€ç»´æ´»è·ƒï¼Œå­¦ä¹ ä¸Šè¸å®è®¤çœŸï¼Œèƒ½ä»å„æ–¹é¢ä¸¥æ ¼è¦æ±‚è‡ªå·±ï¼›æ€§æ ¼å¼€æœ—ï¼Œä¹è§‚å‘ä¸Šï¼Œç§¯æå‚åŠ å„ç§å¿—æ„¿æœåŠ¡æ´»åŠ¨ï¼›å¹³æ—¶å¾…äººéšå’Œè€Œå‹å–„ï¼Œå›¢ç»“åŒå­¦ï¼Œå°Šæ•¬å¸ˆé•¿ï¼Œéµå®ˆæ ¡è§„æ ¡çºªï¼Œä¹äºåŠ©äººï¼›æ˜¯ä¸€åç´ è´¨ä¼˜è‰¯çš„å¤§å­¦ç”Ÿã€‚",
            "\n    è¯¥ç”Ÿèƒ½å¤ŸåšæŒå››é¡¹åŸºæœ¬åŸåˆ™ï¼Œæ‹¥æŠ¤å…šçš„é¢†å¯¼ï¼Œéµå®ˆå„é¡¹æ³•å¾‹æ³•è§„å’Œå­¦æ ¡è§„å®šçš„å„é¡¹è§„ç« åˆ¶åº¦ï¼›å­¦ä¹ ä¸Šï¼Œè®¤çœŸåˆ»è‹¦ï¼Œå…·æœ‰æ‰å®çš„ä¸“ä¸šåŸºç¡€çŸ¥è¯†ï¼Œè¾ƒå¼ºçš„å­¦ä¹ å’Œåˆ›æ–°èƒ½åŠ›ï¼Œå­¦ä¹ æˆç»©ä¼˜å¼‚ï¼›å·¥ä½œè®¤çœŸè´Ÿè´£ï¼Œç§¯æä¸»åŠ¨ï¼Œå°½èŒå°½è´£ï¼Œä¸ºè€å¸ˆå’ŒåŒå­¦åšå¤§é‡å·¥ä½œï¼›æ€§æ ¼å¼€æœ—ã€ç¨³é‡ã€æœ‰æ´»åŠ›ï¼Œå¾…äººçƒ­æƒ…ï¼ŒçœŸè¯šï¼Œå…·æœ‰è‰¯å¥½çš„å›¢é˜Ÿåˆä½œç²¾ç¥å’Œæ²Ÿé€šèƒ½åŠ›ï¼Œæ˜¯ä¸€åå“å­¦å…¼ä¼˜ã€å¾·æ‰å…¼å¤‡çš„å¤§å­¦ç”Ÿã€‚",
            "\n    è¯¥ç”Ÿæ€æƒ³ä¸Šè¿›ï¼Œä½œé£ä¸¥è°¨ï¼Œç§¯æå‚åŠ å­¦æ ¡å’Œç­çº§ç»„ç»‡çš„å„é¡¹å·¥ä½œï¼›å­¦ä¹ æ€åº¦ç«¯æ­£ï¼Œç§¯æå‚åŠ å„é¡¹ç§‘åˆ›æ´»åŠ¨ï¼Œå¹¶å–å¾—ä¼˜å¼‚æˆç»©ï¼›å¯¹å¾…åŒå­¦ï¼ŒçœŸè¯šçƒ­å¿ƒï¼Œä¹äºåŠ©äººï¼›åŠ¨æ‰‹èƒ½åŠ›å’Œè‡ªå­¦èƒ½åŠ›è¾ƒå¼ºï¼Œå…·å¤‡è‰¯å¥½çš„åˆ†æé—®é¢˜å’Œç‹¬ç«‹æ€è€ƒçš„èƒ½åŠ›ï¼Œå¹¶ä¸”æœ‰å¾ˆå¼ºçš„é›†ä½“è£èª‰æ„Ÿï¼›å‹‡äºé¢å¯¹å›°éš¾ï¼Œæ•¢äºè¿æ¥æŒ‘æˆ˜ï¼›æ˜¯ä¸€åå“å­¦å…¼ä¼˜çš„å¤§å­¦ç”Ÿã€‚",
            "\n    è¯¥ç”Ÿåœ¨æ€æƒ³é“å¾·æ–¹é¢å§‹ç»ˆåšæŒæ­£ç¡®çš„ä»·å€¼è§‚å’Œé“å¾·è§‚ï¼Œéµå®ˆæ ¡è§„æ ¡çºªï¼Œå°Šé‡å¸ˆé•¿ï¼Œå›¢ç»“åŒå­¦ã€‚å…³å¿ƒé›†ä½“ï¼Œä¹äºåŠ©äººï¼Œæ€»æ˜¯èƒ½å¤Ÿåœ¨åŒå­¦éœ€è¦å¸®åŠ©æ—¶ä¼¸å‡ºæ´æ‰‹ã€‚åœ¨å­¦ä¹ ä¸Šå§‹ç»ˆä¿æŒç€ä¸¥è°¨çš„å­¦ä¹ æ€åº¦å’Œæ‰å®çš„ä¸“ä¸šçŸ¥è¯†åŸºç¡€ã€‚è¯¾å ‚ä¸Šä¸è€å¸ˆå’ŒåŒå­¦è¿›è¡Œæ·±å…¥è®¨è®ºï¼Œä¸æ–­æ‹“å®½è‡ªå·±çš„çŸ¥è¯†è§†é‡ã€‚åŒæ—¶ï¼Œæ³¨é‡å°†æ‰€å­¦çŸ¥è¯†è¿ç”¨åˆ°å®é™…ç”Ÿæ´»ä¸­ï¼Œåœ¨ç­å›¢æ´»åŠ¨ä¸­è¡¨ç°å‡ºäº†å¼ºçƒˆçš„é›†ä½“è£èª‰æ„Ÿå’Œè´£ä»»æ„Ÿã€‚ç»¼ä¸Šæ‰€è¿°ï¼Œè¯¥ç”Ÿæ˜¯ä¸€ä½å…¨é¢å‘å±•ã€ç»¼åˆç´ è´¨è¾ƒé«˜çš„ä¼˜ç§€åŒå­¦ã€‚",
            "\n    è¯¥ç”Ÿåœ¨æ€æƒ³é“å¾·æ–¹é¢ï¼Œå§‹ç»ˆåšæŒæ­£ç¡®çš„ä»·å€¼è§‚å’Œé“å¾·è§‚ï¼Œéµå®ˆæ ¡è§„æ ¡çºªï¼Œå°Šé‡å¸ˆé•¿ï¼Œå›¢ç»“åŒå­¦ã€‚èƒ½å¤Ÿåœ¨å›°éš¾å’ŒæŒ«æŠ˜é¢å‰ä¿æŒç§¯æä¹è§‚çš„æ€åº¦ï¼Œè¯¥ç”Ÿæ‹¥æœ‰è¾ƒå‡ºè‰²çš„å­¦ä¹ èƒ½åŠ›å’Œæ‰å®çš„åŸºç¡€ã€‚ç»å¸¸å‚ä¸å­¦æœ¯æ´»åŠ¨ï¼Œä¸æ–­æ‹“å±•è‡ªå·±çš„å­¦æœ¯è§†é‡ã€‚è¯¥ç”Ÿå±•ç°å‡ºé«˜åº¦çš„è´£ä»»æ„Ÿå’Œå›¢é˜Ÿåä½œç²¾ç¥ã€‚å–„äºæ²Ÿé€šï¼Œä¹äºåŠ©äººï¼Œç»¼è¿°ï¼Œè¯¥ç”Ÿæ˜¯ä¸€ä½å…¨é¢å‘å±•çš„ä¼˜ç§€å­¦ç”Ÿã€‚"
        ]
        
        # å­¦é™¢æ„è§
        self.college_opinions = [
            "\n    è¯¥ç”Ÿåœ¨å­¦æœŸé—´ï¼Œæ€æƒ³æ€åº¦ç«¯æ­£ï¼Œç§¯æå‘ä¸Šï¼Œéµå®ˆæ ¡è§„æ ¡çºªï¼Œè‡ªæˆ‘çº¦æŸåŠ›å¼ºï¼Œå±•ç°å‡ºè¾ƒå¼ºçš„è´£ä»»æ„Ÿã€‚å­¦ä¹ åˆ»è‹¦ï¼Œæˆç»©è‰¯å¥½ï¼Œç§‘ç ”è®¤çœŸä¸¥è°¨ï¼Œå¯Œæœ‰åˆ›æ–°ç²¾ç¥ã€‚åŒæ—¶ï¼Œç§¯æå‚ä¸å®è·µæ´»åŠ¨ï¼Œå›¢é˜Ÿåä½œèƒ½åŠ›å¼ºã€‚è¯¥ç”Ÿå…¨é¢å‘å±•ï¼Œç»¼åˆç´ è´¨é«˜ï¼Œæ˜¯ä¸€åå“å­¦å…¼ä¼˜çš„å¤§å­¦ç”Ÿã€‚",
            "\n    è¯¥ç”Ÿåœ¨å­¦æœŸé—´ç§¯æå‘ä¸Šï¼Œå­¦ä¹ åŠªåŠ›ï¼Œæˆç»©è‰¯å¥½ï¼Œèƒ½å¤Ÿè®¤çœŸå¬è®²ã€ç§¯ææ€è€ƒï¼Œå¹¶åœ¨è¯¾ååŠæ—¶å¤ä¹ å·©å›ºã€‚è¯¥ç”Ÿç§¯æå‚ä¸å„ç±»å®è·µæ´»åŠ¨ï¼Œä¸æ–­æå‡è‡ªå·±çš„ç»¼åˆç´ è´¨ã€‚éµå®ˆæ ¡è§„æ ¡çºªï¼Œå°Šé‡å¸ˆé•¿ï¼Œä¸åŒå­¦å’Œç¦ç›¸å¤„ï¼Œå±•ç°äº†è‰¯å¥½çš„ä¸ªäººä¿®å…»ã€‚åŒæ—¶ï¼Œè¯¥ç”Ÿä¹Ÿç§¯æå‚ä¸é›†ä½“æ´»åŠ¨ï¼Œä¸ºç­çº§å’Œå­¦é™¢äº‰å…‰ã€‚æ€»ä¹‹ï¼Œè¯¥ç”Ÿæ˜¯ä¸€åè¡¨ç°è‰¯å¥½çš„å¤§å­¦ç”Ÿï¼Œå…·æœ‰è¾ƒå¤§çš„å‘å±•æ½œåŠ›ã€‚",
            "\n    è¯¥ç”Ÿåœ¨å­¦æœŸé—´å±•ç°å‡ºäº†è‰¯å¥½çš„ç»¼åˆç´ è´¨ã€‚å­¦ä¹ è®¤çœŸåˆ»è‹¦ï¼Œåœ¨è¯¾å ‚ä¸Šè¡¨ç°å‡ºè‰²ï¼Œåœ¨è¯¾åä¹Ÿèƒ½ä¸»åŠ¨å¯»æ±‚çŸ¥è¯†ï¼Œä¸æ–­æå‡è‡ªå·±çš„å­¦æœ¯æ°´å¹³ã€‚æ­¤å¤–ï¼Œè¯¥ç”Ÿè¿˜æ³¨é‡åŸ¹å…»è‡ªå·±çš„å…´è¶£çˆ±å¥½å’Œç‰¹é•¿ï¼Œç§¯æå‚ä¸å„ç±»ç¤¾å›¢æ´»åŠ¨å’Œæ¯”èµ›ï¼Œå–å¾—äº†ä¸€å®šæˆç»©ã€‚åœ¨é›†ä½“ç”Ÿæ´»ä¸­ï¼Œè¯¥ç”Ÿèƒ½å¤Ÿç§¯æèå…¥å›¢é˜Ÿï¼Œä¸åŒå­¦ä»¬å‹å¥½ç›¸å¤„ï¼Œå…±åŒä¸ºé›†ä½“è£èª‰è€ŒåŠªåŠ›ã€‚è¯¥ç”Ÿéµå®ˆæ ¡è§„æ ¡çºªï¼Œæ˜¯ä¸€åå“å­¦å…¼ä¼˜çš„å¤§å­¦ç”Ÿã€‚",
            "\n    è¯¥ç”Ÿåœ¨å­¦æœŸé—´ä¸¥æ ¼éµå®ˆæ ¡çºªæ ¡è§„ï¼Œæ€æƒ³æ€åº¦ç«¯æ­£ï¼Œæ”¿æ²»ç«‹åœºæ­£ç¡®ã€‚å­¦ä¹ è®¤çœŸï¼Œå…·å¤‡è‰¯å¥½çš„ç†è®ºçŸ¥è¯†å’Œå®è·µèƒ½åŠ›ï¼›å…´è¶£çˆ±å¥½å¹¿æ³›ï¼Œç§¯æå‚ä¸é™¢æ ¡å„ç±»æ´»åŠ¨ï¼Œè¡¨ç°è‰¯å¥½ï¼›åšäº‹ç¨³é‡è¸å®ï¼Œå…·æœ‰ä¸€å®šçš„ç»„ç»‡åè°ƒå’Œç®¡ç†èƒ½åŠ›ï¼›å°Šæ•¬å¸ˆé•¿ï¼Œå›¢ç»“åŒå­¦ï¼Œäººé™…å…³ç³»è‰¯å¥½ã€‚æ€»ä¹‹ï¼Œæ˜¯ä¸€åä¼˜ç§€çš„æ¯•ä¸šç”Ÿã€‚",
            "\n    è¯¥ç”Ÿåœ¨å­¦æœŸé—´éµçºªå®ˆæ³•ï¼Œæ€æƒ³æ€åº¦ç«¯æ­£ï¼Œç§¯æå‘ä¸Šã€‚å­¦ä¸šæˆç»©çªå‡ºï¼Œä¸“ä¸šçŸ¥è¯†æ‰å®ï¼Œå±•ç°å‡ºè‰¯å¥½çš„å­¦æœ¯ç´ å…»ã€‚åœ¨è¯¾å¤–æ´»åŠ¨ä¸­ï¼Œè¯¥ç”Ÿå±•ç°å‡ºè‰¯å¥½çš„é¢†å¯¼åŠ›å’Œç»„ç»‡åè°ƒèƒ½åŠ›ï¼Œæ·±å—å¸ˆç”Ÿè®¤å¯ã€‚åŒæ—¶ï¼Œè¯¥ç”Ÿå…·å¤‡è‰¯å¥½çš„æ²Ÿé€šèƒ½åŠ›å’Œå›¢é˜Ÿåä½œç²¾ç¥ï¼Œæ˜¯ä¸€åå…¨é¢å‘å±•çš„ä¼˜ç§€æ¯•ä¸šç”Ÿã€‚"
        ]
    
    def process_folder(self, folder_path):
        """å¤„ç†æ–‡ä»¶å¤¹ä¸­çš„æ‰€æœ‰docxæ–‡ä»¶"""
        if not os.path.exists(folder_path):
            raise Exception(f"æ–‡ä»¶å¤¹ä¸å­˜åœ¨: {folder_path}")
        
        # åˆ›å»ºé”™è¯¯æ–‡ä»¶å¤¹
        error_folder = os.path.join(folder_path, "error")
        
        # ç»Ÿè®¡å˜é‡
        total_files = 0
        success_files = 0
        error_files = 0
        
        # è·å–æ‰€æœ‰docxæ–‡ä»¶
        docx_files = [f for f in os.listdir(folder_path) 
                      if f.endswith('.docx') and not f.startswith('~') and f != "error"]
        
        if not docx_files:
            raise Exception("æœªæ‰¾åˆ°ä»»ä½•docxæ–‡ä»¶")
        
        # å¤„ç†æ¯ä¸ªæ–‡ä»¶
        for filename in docx_files:
            total_files += 1
            file_path = os.path.join(folder_path, filename)
            
            # å¤„ç†æ–‡ä»¶
            success = self._process_single_file(file_path, error_folder)
            if success:
                success_files += 1
            else:
                error_files += 1
        
        return {
            'total': total_files,
            'success': success_files,
            'error': error_files,
            'error_folder': error_folder if error_files > 0 else None
        }
    
    def _process_single_file(self, file_path, error_folder):
        """å¤„ç†å•ä¸ªdocxæ–‡ä»¶ï¼Œè‡ªåŠ¨å¡«å†™è¯„è¯­"""
        try:
            # æ‰“å¼€æ–‡æ¡£
            doc = Document(file_path)
            
            # åˆå§‹åŒ–è®¡æ•°å™¨
            academic_years_filled = 0
            comprehensive_filled = 0
            
            # å¤„ç†å„å­¦å¹´çš„å­¦é™¢æ„è§
            for i, year_suffix in enumerate(self.academic_years):
                try:
                    table = self._find_academic_year_table(doc, year_suffix)
                    if table:
                        # é€‰æ‹©è¯„è¯­
                        if i < len(self.academic_year_opinions) and self.academic_year_opinions[i]:
                            evaluation_text = random.choice(self.academic_year_opinions[i])
                        else:
                            evaluation_text = "å­¦ç”Ÿåœ¨æœ¬å­¦å¹´è¡¨ç°è‰¯å¥½ã€‚"
                        
                        if self._fill_evaluation_text(table, "å­¦é™¢ æ„è§", evaluation_text):
                            academic_years_filled += 1
                except Exception:
                    pass
            
            # å¤„ç†ç»¼åˆé‰´å®šè¡¨ï¼ˆè¡¨æ ¼12ï¼‰
            try:
                if len(doc.tables) >= 12:
                    table12 = doc.tables[11]  # ç´¢å¼•ä»0å¼€å§‹
                    
                    # 1. ç­å›¢ç»„ç»‡é‰´å®š (ç¬¬4è¡Œ)
                    if self._fill_table_cell(table12, 3, 1, random.choice(self.class_organization_evaluations)):
                        comprehensive_filled += 1
                    
                    # 2. ç­ä¸»ä»»ç»¼åˆè¯„è¯­ (ç¬¬11è¡Œ)
                    if self._fill_table_cell(table12, 10, 1, random.choice(self.class_teacher_evaluations)):
                        comprehensive_filled += 1
                    
                    # 3. å­¦é™¢æ„è§ (ç¬¬17è¡Œ)
                    if self._fill_table_cell(table12, 16, 1, random.choice(self.college_opinions)):
                        comprehensive_filled += 1
            except Exception:
                pass
            
            # è®¡ç®—æ€»æ•°
            total_filled = academic_years_filled + comprehensive_filled
            
            # ä¸¥æ ¼æ£€æŸ¥ï¼šåªæœ‰æ‰€æœ‰7ä¸ªè¯„è¯­éƒ½æˆåŠŸå¡«å†™æ‰ç®—æˆåŠŸ
            if total_filled == self.total_expected_evaluations:
                # ä¿å­˜æ–‡æ¡£
                doc.save(file_path)
                return True
            else:
                # å°†æ–‡ä»¶ç§»åŠ¨åˆ°é”™è¯¯æ–‡ä»¶å¤¹
                self._move_to_error_folder(file_path, error_folder)
                return False
            
        except Exception:
            # å°†æ–‡ä»¶ç§»åŠ¨åˆ°é”™è¯¯æ–‡ä»¶å¤¹
            self._move_to_error_folder(file_path, error_folder)
            return False
    
    def _find_academic_year_table(self, doc, year_suffix):
        """æŸ¥æ‰¾ç‰¹å®šå­¦å¹´å¯¹åº”çš„å­¦é™¢æ„è§è¡¨æ ¼"""
        # å…ˆå°è¯•æŸ¥æ‰¾åŒ…å«"å­¦å¹´"çš„è¡¨æ ¼
        for i, table in enumerate(doc.tables):
            for row in table.rows:
                for cell in row.cells:
                    try:
                        if year_suffix in cell.text and 'å­¦å¹´' in cell.text:
                            # æ‰¾åˆ°å­¦å¹´æ ‡é¢˜åï¼Œæ£€æŸ¥å½“å‰è¡¨æ ¼å’Œä¸‹ä¸€ä¸ªè¡¨æ ¼
                            for next_idx in [i, i + 1]:
                                if next_idx < len(doc.tables):
                                    target_table = doc.tables[next_idx]
                                    if self._find_cell_by_text(target_table, "å­¦é™¢ æ„è§")[0] is not None:
                                        return target_table
                    except Exception:
                        continue
        
        # å†å°è¯•æŸ¥æ‰¾åªåŒ…å«å¹´ä»½çš„è¡¨æ ¼
        for i, table in enumerate(doc.tables):
            for row in table.rows:
                for cell in row.cells:
                    try:
                        cell_text = cell.text
                        if year_suffix in cell_text:
                            # æ‰¾åˆ°å¹´ä»½æ ‡é¢˜åï¼Œæ£€æŸ¥å½“å‰è¡¨æ ¼å’Œä¸‹ä¸€ä¸ªè¡¨æ ¼
                            for next_idx in [i, i + 1]:
                                if next_idx < len(doc.tables):
                                    target_table = doc.tables[next_idx]
                                    if self._find_cell_by_text(target_table, "å­¦é™¢ æ„è§")[0] is not None:
                                        return target_table
                    except Exception:
                        continue
        
        return None
    
    def _find_cell_by_text(self, table, search_text):
        """åœ¨è¡¨æ ¼ä¸­æŸ¥æ‰¾åŒ…å«æŒ‡å®šæ–‡æœ¬çš„å•å…ƒæ ¼"""
        for i, row in enumerate(table.rows):
            for j, cell in enumerate(row.cells):
                try:
                    cell_text = cell.text.replace('\n', ' ')
                    if search_text in cell_text:
                        return i, j, cell
                except Exception:
                    continue
        return None, None, None
    
    def _fill_evaluation_text(self, table, search_text, evaluation_text):
        """åœ¨è¡¨æ ¼ä¸­æŸ¥æ‰¾å¹¶å¡«å†™è¯„è¯­"""
        try:
            row_idx, col_idx, cell = self._find_cell_by_text(table, search_text)
            if cell and row_idx is not None:
                # å¡«å†™è¯„è¯­åˆ°ç¬¬äºŒåˆ—ï¼ˆå†…å®¹åˆ—ï¼‰
                content_cell = table.rows[row_idx].cells[1] if len(table.rows[row_idx].cells) > 1 else cell
                content_cell.text = evaluation_text
                
                # è®¾ç½®å­—ä½“æ ¼å¼
                self._format_cell_text(content_cell)
                return True
        except Exception:
            pass
        return False
    
    def _fill_table_cell(self, table, row_idx, col_idx, text):
        """å¡«å†™è¡¨æ ¼ç‰¹å®šä½ç½®çš„å•å…ƒæ ¼"""
        try:
            if len(table.rows) > row_idx and len(table.rows[row_idx].cells) > col_idx:
                cell = table.rows[row_idx].cells[col_idx]
                cell.text = text
                self._format_cell_text(cell)
                return True
        except Exception:
            pass
        return False
    
    def _format_cell_text(self, cell):
        """è®¾ç½®å•å…ƒæ ¼æ–‡æœ¬æ ¼å¼"""
        for paragraph in cell.paragraphs:
            for run in paragraph.runs:
                run.font.name = "å®‹ä½“"
                run.font.size = Pt(10.5)
                run._element.rPr.rFonts.set(qn('w:eastAsia'), 'å®‹ä½“')
    
    def _move_to_error_folder(self, file_path, error_folder):
        """å°†æ–‡ä»¶ç§»åŠ¨åˆ°é”™è¯¯æ–‡ä»¶å¤¹"""
        if not os.path.exists(error_folder):
            os.makedirs(error_folder)
        error_file_path = os.path.join(error_folder, os.path.basename(file_path))
        if os.path.exists(file_path):
            shutil.move(file_path, error_file_path)
    
    def process_class_files(self, class_dir: str) -> int:
        """
        å¤„ç†æŸä¸ªç­çº§æ–‡ä»¶å¤¹ä¸­çš„æ‰€æœ‰æ–‡ä»¶
        
        Args:
            class_dir: ç­çº§æ–‡ä»¶å¤¹è·¯å¾„
            
        Returns:
            int: æˆåŠŸå¤„ç†çš„æ–‡ä»¶æ•°é‡
        """
        if not os.path.exists(class_dir):
            print(f"âŒ ç­çº§æ–‡ä»¶å¤¹ä¸å­˜åœ¨: {class_dir}")
            return 0
        
        # è·å–æ‰€æœ‰docxæ–‡ä»¶
        docx_files = []
        for file in os.listdir(class_dir):
            if file.endswith('.docx') and not file.startswith('~'):
                docx_files.append(file)
        
        if not docx_files:
            print(f"âš ï¸  ç­çº§æ–‡ä»¶å¤¹ä¸­æœªæ‰¾åˆ°ä»»ä½•docxæ–‡ä»¶: {class_dir}")
            return 0
        print(f"ğŸ“ å¤„ç†ç­çº§æ–‡ä»¶å¤¹: {os.path.basename(class_dir)}")
        print(f"ğŸ“„ æ‰¾åˆ° {len(docx_files)} ä¸ªæ–‡ä»¶éœ€è¦å¤„ç†")
        
        success_count = 0
        error_folder = os.path.join(class_dir, "å¤„ç†å¤±è´¥çš„æ–‡ä»¶")
        
        for i, filename in enumerate(docx_files, 1):
            file_path = os.path.join(class_dir, filename)
            print(f"[{i}/{len(docx_files)}] æ­£åœ¨å¡«å†™è¯„è¯­: {filename}")
            
            try:
                if self._process_single_file(file_path, error_folder):
                    success_count += 1
                    print(f"âœ“ å¤„ç†æˆåŠŸ: {filename}")
                else:
                    print(f"âœ— å¤„ç†å¤±è´¥: {filename}")
                    # _process_single_file å·²ç»å¤„ç†äº†é”™è¯¯æ–‡ä»¶çš„ç§»åŠ¨
                    
            except Exception as e:
                print(f"âœ— å¤„ç†å¤±è´¥: {filename} - {str(e)}")
                self._move_to_error_folder(file_path, error_folder)
        
        print(f"ğŸ“Š ç­çº§å¤„ç†å®Œæˆ: æˆåŠŸ {success_count}/{len(docx_files)} ä¸ªæ–‡ä»¶")
        
        # å¦‚æœé”™è¯¯æ–‡ä»¶å¤¹ä¸ºç©ºï¼Œåˆ é™¤å®ƒ
        if os.path.exists(error_folder) and not os.listdir(error_folder):
            os.rmdir(error_folder)
        
        return success_count
